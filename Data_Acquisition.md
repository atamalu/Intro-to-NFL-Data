Acquiring NFL Data
================

Here are some methods of acquiring data

## 1\. nflscrapR

The `nflscrapR` package is good for retrieving play-by-play data from
the NFL game center. This is well-documented so I won’t beat a dead
horse. For working with SQL tables and nflscrapR, please see the
`Storing and Loading Data in SQL` page

## 2\. NFL Fantasy API

While nflscrapR is incredibly useful, we do not always want to work with
information on a play-by-play basis. Because of this, I decided to write
the function `get_nflapi_data` to get player-level data.

`get_nflapi_data` essentially works as one-size-fits-all way to gather
data from the supported NFL Fantasy API webpages. There are 2 arguments:

  - `Data.type` - the type of data to grab via the NFL Fantasy API
  - `Params` - list of parameters for the query that can be found in the
    [NFL Fantasy API documentation](https://api.fantasy.nfl.com/v1/docs)
      - Currently supported parameters are: “editordraftranks”,
        “userdraftranks”, “researchinfo”, “news”, “scoringleaders”,
        “stats”, “details”, “advanced”

<!-- end list -->

``` r
rm(list = ls()) # clear workspace
source('Functions/API/get_nflapi_data.R') # load function & packages
```

As an example, let’s say we want to get player news for 20 players

``` r
params <- list(count = 20) # can also add any valid params to list

df.news <- get_nflapi_data(Data.type = 'news', Params = params)
glimpse(df.news)
```

    ## Observations: 18
    ## Variables: 12
    ## $ id           <chr> "506483", "506481", "506480", "506477", "506474",...
    ## $ esbid        <chr> "HER373492", "FER558663", "BRE229498", "CAN149679...
    ## $ gsisPlayerId <chr> "00-0034766", "00-0035692", "00-0020531", "00-003...
    ## $ firstName    <chr> "Chris", "Clelin", "Drew", "Maurice", "Joey", "Re...
    ## $ lastName     <chr> "Herndon", "Ferrell", "Brees", "Canady", "Bosa", ...
    ## $ position     <chr> "TE", "DL", "QB", "DB", "DL", "DB", "LB", "LB", "...
    ## $ teamAbbr     <chr> "NYJ", "OAK", "NO", "BAL", "LAC", "MIA", "LAC", "...
    ## $ timestamp    <chr> "2019-10-14 13:37:13", "2019-10-14 13:21:34", "20...
    ## $ source       <chr> "rotowire", "rotowire", "rotowire", "rotowire", "...
    ## $ headline     <chr> "Returns to active roster", "Cleared to practice"...
    ## $ body         <chr> "Herndon (hamstring) had his roster exemption lif...
    ## $ analysis     <chr> "Herndon&apos;s suspension was lifted after Week ...

The function actually specifies the `format = json` parameter if it is
not included (only json is supported). Additionally, if the input for
`Data.type` is not valid, an error is returned with the supported data
types.

If we want to get all of the data types, we can simply apply the
function across parameter names in the data frame that is automatically
loaded with the function: `data.info`

``` r
d.types <- data.info$Type
df.list <- sapply(d.types, get_nflapi_data)
```

##### Note

The `details` data frame requires the parameter `playerId`

## 3\. Pro Football Reference

Pro-Football Reference offers some pretty useful metrics that are hard
to find elsewhere.

I currently have 2 functions written for scraping PFR. The code is
basically identical between functions, except catered to the respective
data type.

### Defense vs. Position (Team)

To get defense vs. position data, use `FR_def_vs_pos`. This has 2
arguments: \* `Pos` - abbreviation of player position \* `Year` - start
year of NFL season

``` r
source('Functions/FR/FR_def_vs_pos.R')
```

    ## Loading required package: xml2

``` r
df <- FR_def_vs_pos(Pos = 'TE', Year = 2019)
glimpse(df)
```

    ## Observations: 32
    ## Variables: 12
    ## $ team                       <chr> "Arizona Cardinals", "Tampa Bay Buc...
    ## $ g                          <dbl> 6, 6, 6, 6, 6, 5, 6, 6, 5, 6, 6, 6,...
    ## $ targets                    <dbl> 56, 60, 47, 46, 43, 44, 36, 64, 37,...
    ## $ rec                        <dbl> 46, 41, 34, 33, 26, 32, 25, 46, 22,...
    ## $ rec_yds                    <dbl> 599, 497, 405, 342, 275, 334, 239, ...
    ## $ rec_td                     <dbl> 7, 3, 3, 4, 4, 3, 4, 1, 3, 3, 2, 2,...
    ## $ fantasy_points             <dbl> 101.9, 67.7, 58.5, 58.2, 51.5, 51.4...
    ## $ draftkings_points          <dbl> 156.9, 114.7, 97.5, 94.2, 80.5, 83....
    ## $ fanduel_points             <dbl> 124.9, 88.2, 77.5, 74.7, 64.5, 67.4...
    ## $ fantasy_points_per_game    <dbl> 17.0, 11.3, 9.8, 9.7, 8.6, 10.3, 8....
    ## $ draftkings_points_per_game <dbl> 26.2, 19.1, 16.3, 15.7, 13.4, 16.7,...
    ## $ fanduel_points_per_game    <dbl> 20.8, 14.7, 12.9, 12.5, 10.8, 13.5,...

### Season Fantasy Stats (Player)

`FR_players_fantasy` gets fantasy-catered player statistics for the
season. It has 2 arguments:

  - `Year` - the year of data to grab
  - `Per.game` - converts statistics to per-game

<!-- end list -->

``` r
source('Functions/FR/FR_players_fantasy.R')

df <- FR_players_fantasy()
glimpse(df)
```

    ## Observations: 496
    ## Variables: 33
    ## $ ranker               <chr> "1", "2", "3", "4", "5", "6", "7", "8", "...
    ## $ player               <chr> "Christian McCaffrey", "Russell Wilson", ...
    ## $ team                 <chr> "CAR", "SEA", "MIN", "BAL", "HOU", "CLE",...
    ## $ fantasy_pos          <chr> "RB", "QB", "RB", "QB", "QB", "RB", "WR",...
    ## $ age                  <dbl> 23, 31, 24, 22, 24, 24, 23, 34, 24, 30, 2...
    ## $ g                    <dbl> 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 6, 6, 6,...
    ## $ gs                   <dbl> 6, 6, 6, 6, 6, 6, 6, 6, 6, 6, 5, 5, 6, 6,...
    ## $ pass_cmp             <dbl> 0, 137, 0, 127, 140, 0, 0, 186, 147, 0, 0...
    ## $ pass_att             <dbl> 1, 189, 0, 195, 201, 0, 0, 258, 230, 0, 0...
    ## $ pass_yds             <dbl> 0, 1704, 0, 1507, 1644, 0, 0, 2011, 2104,...
    ## $ pass_td              <dbl> 0, 14, 0, 11, 12, 0, 0, 15, 14, 0, 0, 0, ...
    ## $ pass_int             <dbl> 0, 0, 0, 5, 3, 0, 0, 7, 1, 0, 0, 0, 6, 0,...
    ## $ rush_att             <dbl> 127, 36, 108, 69, 32, 114, 0, 13, 16, 87,...
    ## $ rush_yds             <dbl> 618, 151, 583, 460, 164, 607, 0, 62, 80, ...
    ## $ rush_yds_per_att     <dbl> 4.87, 4.19, 5.40, 6.67, 5.13, 5.32, NA, 4...
    ## $ rush_td              <dbl> 7, 3, 6, 2, 5, 6, 0, 1, 0, 7, 8, 3, 2, 2,...
    ## $ targets              <dbl> 44, 0, 26, 0, 0, 26, 55, 0, 0, 12, 23, 45...
    ## $ rec                  <dbl> 35, 0, 23, 0, 0, 20, 43, 0, 0, 11, 19, 42...
    ## $ rec_yds              <dbl> 305, 0, 213, 0, 0, 128, 662, 0, 0, 89, 15...
    ## $ rec_yds_per_rec      <dbl> 8.71, NA, 9.26, NA, NA, 6.40, 15.40, NA, ...
    ## $ rec_td               <dbl> 2, 0, 0, 0, 0, 0, 6, 0, 0, 0, 0, 3, 0, 3,...
    ## $ fumbles              <dbl> 0, 3, 2, 2, 6, 1, 0, 2, 3, 1, 1, 2, 0, 0,...
    ## $ fumbles_lost         <dbl> 0, 1, 1, 0, 2, 1, 0, 1, 2, 1, 0, 2, 0, 0,...
    ## $ all_td               <dbl> 9, 3, 6, 2, 5, 6, 6, 1, 0, 7, 8, 6, 2, 5,...
    ## $ two_pt_md            <dbl> NA, NA, NA, NA, NA, NA, NA, NA, NA, 1, NA...
    ## $ two_pt_pass          <dbl> NA, 1, NA, 1, 1, NA, NA, 3, NA, NA, NA, N...
    ## $ fantasy_points       <dbl> 146, 157, 114, 154, 152, 108, 102, 143, 1...
    ## $ fantasy_points_ppr   <dbl> 181.3, 157.3, 136.6, 154.3, 152.2, 127.5,...
    ## $ draftkings_points    <dbl> 187.3, 164.3, 143.6, 165.3, 163.2, 134.5,...
    ## $ fanduel_points       <dbl> 163.8, 157.3, 125.1, 159.3, 155.2, 117.5,...
    ## $ vbd                  <dbl> 95, 63, 62, 60, 58, 56, 56, 49, 48, 42, 4...
    ## $ fantasy_rank_pos     <dbl> 1, 1, 2, 2, 3, 3, 1, 4, 5, 4, 5, 6, 6, 7,...
    ## $ fantasy_rank_overall <dbl> 1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13...
